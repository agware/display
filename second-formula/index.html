<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Second Formula</title>

    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="../scripts/styles.css">

</head>
<body>

<div id="wrapper">
    <div id="container">
        <div id="animation"></div>
        <div id="control"></div>
    </div>
</div>

<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="../scripts/animationEls.js" type="text/javascript"></script>
<script src="../scripts/actionButtons.js" type="text/javascript"></script>
<script src="../scripts/formula.js" type="text/javascript"></script>
<script src="../scripts/radioButtons.js" type="text/javascript"></script>
<script src="../scripts/dragButtons.js" type="text/javascript"></script>

<script>

    const height = 350;
    const animationWidth = 700;
    const controlWidth = 200;

    const scalingFactor = 30;

    var eqVars = [{'name': 'u', 'active': 90, 'eq': 'u = ', 'measure': 'm/s'},
                  {'name': 'a', 'active': 60, 'eq': 'a = ', 'measure': 'm/s²'}];

    init();

    function init() {

        var animation = {'start': Date.now(), 'mem': 0, 'state': true};

        var animationSvg = d3.select('div#animation').append('svg')
            .attr('width', animationWidth)
            .attr('height', height)
            .attr('overflow', 'hidden');

        var controlSvg = d3.select('div#control').append('svg')
            .attr('height', height)
            .attr('width', controlWidth)
            .attr('overflow', 'hidden')
            .style('border', 'solid black 2px');

        const ballRadius = 38;
        initBall(animationSvg, ballRadius);

        const formula = ['x', '=', 'u', '•', 't', '+', '½', '•', 'a', '•', 't', '²'];
        const textGap = [0, 30, 30, 33, 22, 30, 37, 43, 20, 30, 20, 28];
        initFormula(animationSvg, formula, textGap);

        controlSvg.append('g')
            .attr('transform', 'translate(0,' + (100) + ')')
            .attr('id', 'radioContainer');
        initFormulaRadio(d3.select('#radioContainer'));

        initButtons(controlSvg, animation);

        const num = 6;
        initDots(num);

        controlSvg.append('g')
            .attr('transform', 'translate(0,' + (height - 110) + ')')
            .attr('id', 'dragContainer');
        initDrag(d3.select('#dragContainer'));

        d3.timer(animateBall);


        // Animate
        function animateBall() {
            if (animation.state) {
                var secondCount = (Date.now() - animation.start) / 1000;
                var loc = convert(eqVars[0].active) * secondCount + (1 / 2) * convert(eqVars[1].active) * Math.pow(secondCount, 2);
                d3.select('#ball').attr('cx', loc);



                if (loc > animationWidth + parseInt(d3.select('#ball').attr('r'))) {
                    clickPause(animation);
                    resetBall(animation);
                    secondCount = 0;
                }

                if (d3.select('#numbersRadio').classed('active')) {
                    updateNumbers(Math.floor(secondCount));
                }
            }
        }
    }

    function updateDots() {

        var numDots = d3.select('#dots').selectAll('circle').size();

        for (var k=0; k<numDots; k++) {
            d3.select('#dots' + k)
                .transition()
                .duration(750)
                .attr('transform', 'translate(' + (convert(eqVars[0].active)*k + (1/2)*convert(eqVars[1].active)*Math.pow(k,2)) + ',0)');

            d3.select('#topText' + k).text((Math.floor(eqVars[0].active/scalingFactor)*k + (1/2)*Math.floor(eqVars[1].active/scalingFactor)*Math.pow(k,2)) + 'm');
            d3.select('#bottomText' + k).text(k + 's');
        }
    }

    function updateDrag(index) {
        d3.select('#' + eqVars[index].name + 'Text').text(eqVars[index].eq + Math.floor(eqVars[index].active/scalingFactor) + eqVars[index].measure);
        d3.select('#' + eqVars[index].name + 'LineBody').attr('x2', eqVars[index].active);
        d3.select('#' + eqVars[index].name + 'DraggableContainer').attr('transform', 'translate(' + eqVars[index].active + ',0)');
    }

    // Utils
    function convert(input) {
        return Math.floor(input/scalingFactor)*scalingFactor;
    }

</script>

</body>
</html>